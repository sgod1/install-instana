env:
#
# cpu and memory requests
#
- name: clickhouse-container-req-cpu
  path: >
    .spec.templates.podTemplates.[] | select(.name == "clickhouse") |
    .spec.containers.[] | select(.name == "instana-clickhouse") |
    .resources.requests.cpu
  values:
    default: 1500m
    uat: 11
    prod: 23
    #small:
    #medium:
    #large:

- name: clickhouse-container-req-mem
  path: >
    .spec.templates.podTemplates.[] | select(.name == "clickhouse") |
    .spec.containers.[] | select(.name == "instana-clickhouse") |
    .resources.requests.memory
  values:
    default: 4Gi
    uat: 44Gi
    prod: 92Gi
    #small:
    #medium:
    #large:

#
# storage requests
#
- name: clickhouse-data-volume-request
  path: >
    .spec.templates.volumeClaimTemplates.[] | select(.name == "instana-clickhouse-data-volume") |
    .spec.resources.requests.storage
  values:
    default: 500Gi
    uat: 750Gi
    #prod: 2950Gi
    # reducing, must monitor
    prod: 1500Gi
    #small:
    #medium:
    #large:

- name: clickhouse-cold-volume-request
  path: >
    .spec.templates.volumeClaimTemplates.[] | select(.name == "instana-clickhouse-cold-volume") |
    .spec.resources.requests.storage
  values:
    default: 500Gi
    uat: 750Gi
    #prod: 2950Gi
    # reducing, must monitor
    prod: 1500Gi
    #small:
    #medium:
    #large:

- name: clickhouse-log-volume-request
  path: >
    .spec.templates.volumeClaimTemplates.[] | select(.name == "instana-clickhouse-log-volume") |
    .spec.resources.requests.storage
  values:
    default: 500Gi
    uat: 750Gi
    #prod: 2950Gi
    # reducing, must monitor
    prod: 1500Gi
    #small:
    #medium:
    #large:

#
# shards count
# shards-replicas, replicas fixed to 2
#
- name: shards-count
  path: >
    .spec.configuration.clusters.[] | select(.name == "local") |
    .layout.shardsCount
  values:
    default: 1
    uat: 4
    prod: 10
    #small:
    #medium:
    #large:

#
# container images
#
- name: clickhouse-container-image
  path: >
    .spec.templates.podTemplates.[] | select(.name == "clickhouse") |
    .spec.containers.[] | select(.name == "instana-clickhouse") |
    .image
  values:
    default: strenv(clickhouse_container_image)

- name: clickhouse-log-image
  path: >
    .spec.templates.podTemplates.[] | select(.name == "clickhouse") |
    .spec.containers.[] | select(.name == "clickhouse-log") |
    .image
  values:
    default: strenv(clickhouse_log_image)

#
# storage classes
#
- name: clickhouse-data-volume-storage-class
  path: >
    .spec.templates.volumeClaimTemplates.[] | select(.name == "instana-clickhouse-data-volume") |
    .spec.storageClassName
  values:
    default: strenv(rwo_storageclass)

- name: clickhouse-cold-volume-storage-class
  path: >
    .spec.templates.volumeClaimTemplates.[] | select(.name == "instana-clickhouse-cold-volume") |
    .spec.storageClassName
  values:
    default: strenv(rwo_storageclass)

- name: clickhouse-log-volume-storage-class
  path: >
    .spec.templates.volumeClaimTemplates.[] | select(.name == "instana-clickhouse-log-volume") |
    .spec.storageClassName
  values:
    default: strenv(rwo_storageclass)

#
# user passwords
#
- name: clickhouse-admin-password
  path: >
    .spec.configuration.users
    ."default/password"
  values:
    default: strenv(clickhouse_admin_pass)

- name: clickhouse-user-password
  path: >
    .spec.configuration.users
    ."clickhouse-user/password"
  values:
    default: strenv(clickhouse_user_pass)

#
# remote servers secrets
#
- name: remote-servers-all-replicated-secret
  path: >
    .spec.configuration.settings
    ."remote_servers/all-replicated/secret"
  values:
    default: strenv(clickhouse_user_pass)

- name: remote-servers-all-sharded-secret
  path: >
    .spec.configuration.settings
    ."remote_servers/all-sharded/secret"
  values:
    default: strenv(clickhouse_user_pass)

- name: remote-servers-local-secret
  path: >
    .spec.configuration.settings
    ."remote_servers/local/secret"
  values:
    default: strenv(clickhouse_user_pass)

#
# tolerations
#
- name: clickhouse-pod-template-toleration-key
  path: >
    .spec.templates.podTemplates.[] | select(.name=="clickhouse") |
    .spec.tolerations[0].key
  values:
    default: strenv(clickhouse_toleration_key)
    #uat: dedicated
    #prod: dedicated

- name: clickhouse-pod-template-toleration-value
  path: >
    .spec.templates.podTemplates.[] | select(.name=="clickhouse") |
    .spec.tolerations[0].value
  values:
    default: strenv(clickhouse_toleration_value)
    #uat: appng
    #prod: appng
